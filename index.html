<!DOCTYPE html>
<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
    <title>Organisation Chart</title>
    <link rel="stylesheet" href="assets/css/bootstrap.min.css" type="text/css"/>
    <link rel="stylesheet" href="assets/css/jquery.jOrgChart.css" type="text/css"/>
    <link rel="stylesheet" href="assets/css/custom.css" type="text/css"/>
    <link rel="stylesheet" href="assets/css/prettify.css" type="text/css"/>

    <script type="text/javascript" src="assets/js/prettify.js"></script>
    
    <!-- jQuery includes -->
    <script type="text/javascript" src="assets/js/jquery.min.js"></script>
    <script type="text/javascript" src="assets/js/jquery-ui.min.js"></script>
    
    <script src="assets/js/jquery.jOrgChart.js"></script>
	<script src="data/data1.js" ></script>
    <script>
    jQuery(document).ready(function() {
        $("#org").jOrgChart({
            chartElement : '#chart',
            dragAndDrop  : true
        });
    });
    </script>
  </head>

  <body onload="prettyPrint();">
    <div class="topbar">
        <div class="topbar-inner">
            <div class="container">
                <a class="brand" href="#">Organisation Chart</a>
                <ul class="nav">
                    <li><a href="">Menu1</a></li>
                    <li><a href="">Menu2</a></li>                        
                </ul>
                <div class="pull-right">
                    <div class="alert-message info" id="show-list">Show underlying list.</div>
                    
<pre class="prettyprint lang-html" id="list-html" style="display:none"></pre>       
                </div>              
            </div>
        </div>
    </div>
    
	<ul id="org" style="display:none"></ul>
             
    
    <div id="chart" class="orgChart"></div>

    
<script>
	console.log("data = "+data.length);
	var ul = document.getElementById('org');
	var lastLi;
	//for(var i in data) {
	//for(i=0; i<20 ; i++) {
		//var display = data[i].nom+" "+data[i].prenom
		//console.log(i,display );
		var display = data[0].nom+" "+data[0].prenom
		var li = document.createElement('li');
		ul.appendChild(li);
		li.innerHTML=li.innerHTML + display;
		li.dataset.name = data[0].prenom+" "+data[0].nom;
		
		
		/*while(isChild()){
			var htmlChildren = li.firstElementChild.children;
			var children = findChildren(li.dataset.name);
			drawChildren(li,children);
		}*/
		
		var children = findChildren(li.dataset.name);
		drawChildren(li,children);
		/*if (children.length > 0){
			console.log(display, "enfant =",children );
			ulChild = document.createElement('ul');
			li.appendChild(ulChild);
			for(var i in children) {
				var liChild = document.createElement('li');
				ulChild.appendChild(liChild);
				display = children[i].nom+" "+children[i].prenom;
				liChild.innerHTML=liChild.innerHTML + display;
				liChild.dataset.name = children[i].prenom+" "+children[i].nom;
			}
		}*/
		
		/*var htmlChildren = li.firstElementChild.children;
		for(var i=0;i<htmlChildren.length;i++){
			//console.log(i, htmlChildren[i].dataset.name);
			children = findChildren(htmlChildren[i].dataset.name);
			console.log(i, children);
			drawChildren(htmlChildren[i],children);
		}*/
			
		//t = document.createTextNode(display);
		//li.innerHTML=li.innerHTML + display;
		console.log("data = "+data.length);
	//}
	
	function findChildren(hierarchy) {
		var children = [];
		var indexes = [];
		for(var i in data) {
			if (data[i].hierarchie == hierarchy) {
				children.push(data[i]);
				indexes.push(i);
			}
		}
		// On supprime les éléments du tableau d'origine afin de ne plus itérer dessus (performances)
		/*if(indexes.length>0){
			for(var i in indexes) {
				data.splice(indexes[i],1);
			}
		}		*/
		return children;
	}
	
	function drawChildren(li,children){
		if (children.length > 0){
			var ulChild = document.createElement('ul');
			li.appendChild(ulChild);
			for(var i in children) {
				var liChild = document.createElement('li');
				ulChild.appendChild(liChild);
				display = children[i].nom+" "+children[i].prenom;
				liChild.innerHTML=liChild.innerHTML + display;
				liChild.dataset.name = children[i].prenom+" "+children[i].nom;
				var c  = findChildren(liChild.dataset.name);
				drawChildren(liChild,c);
			}
		}
	}
	</script>
	
	
    <script>
        jQuery(document).ready(function() {
            
            /* Custom jQuery for the example */
            $("#show-list").click(function(e){
                e.preventDefault();
                
                $('#list-html').toggle('fast', function(){
                    if($(this).is(':visible')){
                        $('#show-list').text('Hide underlying list.');
                        $(".topbar").fadeTo('fast',0.9);
                    }else{
                        $('#show-list').text('Show underlying list.');
                        $(".topbar").fadeTo('fast',1);                  
                    }
                });
            });
            
            $('#list-html').text($('#org').html());
            
            $("#org").bind("DOMSubtreeModified", function() {
                $('#list-html').text('');
                
                $('#list-html').text($('#org').html());
                
                prettyPrint();                
            });
        });
    </script>

</body>
</html>